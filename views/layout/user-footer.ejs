<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const cartItemsContainer = document.getElementById('cart-items-container');

    // Delegate events for increase, decrease, and remove buttons
    cartItemsContainer.addEventListener('click', async (e) => {
        e.preventDefault();

        const target = e.target.closest('.increase, .decrease, .remove');
        if (!target) return; // not a relevant button

        const id = target.dataset.id;
        let url = '';

        if (target.classList.contains('increase')) {
            url = `/cart/increase/${id}`;
        } else if (target.classList.contains('decrease')) {
            url = `/cart/decrease/${id}`;
        } else if (target.classList.contains('remove')) {
            url = `/cart/remove/${id}`;
        }

        try {
            const res = await fetch(url);
            const data = await res.json();

            // Update the entire cart UI
            updateCartUI(data.cart);
        } catch (err) {
            console.error('Cart update error:', err);
        }
    });

    function updateCartUI(cartData) {
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        const cartCount = document.getElementById('cart-count');

        if (!cartData || cartData.length === 0) {
            cartItems.innerHTML = `
        <tr>
          <td colspan="6" class="text-center text-muted p-5">
            Your cart is empty
          </td>
        </tr>`;
            cartTotal.innerText = '$0';
            cartCount.innerText = '0';
            return;
        }

        let total = 0;
        cartItems.innerHTML = '';
        cartData.forEach(item => {
            total += item.price * item.qty;
            cartItems.innerHTML += `
        <tr id="cart-item-${item._id}">
          <td><img src="${item.image}" width="50" alt="${item.name}"></td>
          <td>${item.name}</td>
          <td class="text-center">
            <a href="#" class="btn btn-sm btn-outline-warning decrease" data-id="${item._id}">-</a>
            <span class="mx-1">${item.qty}</span>
            <a href="#" class="btn btn-sm btn-outline-success increase" data-id="${item._id}">+</a>
          </td>
          <td>$${item.price}</td>
          <td>$${item.price * item.qty}</td>
          <td><a href="#" class="btn btn-sm btn-danger remove" data-id="${item._id}">Remove</a></td>
        </tr>`;
        });

        cartTotal.innerText = `$${total}`;
        cartCount.innerText = cartData.length;
    }
</script>

    
    <script>
        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.style.padding = '10px 0';
                navbar.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
            } else {
                navbar.style.padding = '20px 0';
                navbar.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.05)';
            }
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if(targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if(targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>

      <script>
            document.getElementById("checkout-btn").addEventListener("click", function () {
                setTimeout(() => {
                    window.location.href = "/checkout"; // ðŸ”¥ force redirect after closing cart
                }, 200); // wait for offcanvas animation
            });
        </script>
     


</body>

</html>