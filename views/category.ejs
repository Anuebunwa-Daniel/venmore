<%- include('layout/user-header.ejs') %>

    <!-- Breadcrumb -->
    <div class="container mt-5 pt-5">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item"><a href="#">Categories</a></li>
                <li class="breadcrumb-item active" aria-current="page">Phone Cases</li>
            </ol>
        </nav>
    </div>

    <!-- Category Header -->
    <section class="category-header">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h1>
                        <%= categoryName.toUpperCase() %>
                    </h1>
                    <p class="text-muted">Our products are the best in Quality and durations </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
<div class="container mt-4">
    <div class="row g-4">
        
        <% if (products && products.length > 0) { %>
            <% products.forEach(product => { %>
            
                <div class="col-lg-3 col-md-6 col-sm-12">
                    <div class="card h-100 shadow-sm">
                        
                        <div class="position-relative">
                            <span class="badge bg-success position-absolute top-0 start-0 m-2">Bestseller</span>
                            <img src="<%= product.image %>" class="card-img-top" alt="<%= product.productName %>">
                        </div>

                        <div class="card-body">
                            <h5 class="card-title"><%= product.productName %></h5>
                            <p class="card-text text-muted"><%= product.desc %></p>

                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">&#8358;<%= product.price %></h5>

                                <button class="btn btn-primary btn-sm add-to-cart"
                                    data-id="<%= product._id %>"
                                    data-name="<%= product.productName %>"
                                    data-price="<%= product.price %>"
                                    data-image="<%= product.image %>">
                                    Add to Cart
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

            <% }) %>

        <% } else { %>
            <h3 class="text-center">No products available yet.</h3>
        <% } %>

    </div>
</div>


            <!-- Pagination -->
            <nav aria-label="Product pagination" class="mt-5">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Cart Sidebar -->
        <div class="cart-sidebar" id="cart-sidebar">
            <div class="cart-header">
                <h5 class="cart-title">Your Cart</h5>
                <button class="close-cart" id="close-cart">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="cart-items" id="cart-items">
                <!-- Cart items will be dynamically added here -->
                <div class="empty-cart">
                    <div class="empty-cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h5>Your cart is empty</h5>
                    <p class="text-muted">Add some products to your cart</p>
                </div>
            </div>
            <div class="cart-summary" id="cart-summary" style="display: none;">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="cart-total">$0.00</span>
                </div>
                <button class="btn btn-primary checkout-btn">Proceed to Checkout</button>
            </div>
        </div>

        <!-- Overlay -->
        <div class="overlay" id="overlay"></div>

        <!-- Toast Container -->
        <div class="toast-container" id="toast-container"></div>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <a href="#" class="footer-logo">
                            <i class="fas fa-mobile-alt me-2"></i>TechShield Pro
                        </a>
                        <p class="mb-4">Your trusted source for premium phone accessories and replacement parts. Quality
                            products, fast shipping, and excellent customer service.</p>
                        <div class="social-icons">
                            <a href="#" class="social-icon">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                        <div class="footer-links">
                            <h5>Shop</h5>
                            <ul>
                                <li><a href="#">Phone Cases</a></li>
                                <li><a href="#">Screen Protectors</a></li>
                                <li><a href="#">Chargers</a></li>
                                <li><a href="#">Cables</a></li>
                                <li><a href="#">Replacement Parts</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                        <div class="footer-links">
                            <h5>Support</h5>
                            <ul>
                                <li><a href="#">Contact Us</a></li>
                                <li><a href="#">Shipping Policy</a></li>
                                <li><a href="#">Returns & Refunds</a></li>
                                <li><a href="#">FAQ</a></li>
                                <li><a href="#">Size Guide</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4">
                        <div class="footer-links">
                            <h5>Company</h5>
                            <ul>
                                <li><a href="#">About Us</a></li>
                                <li><a href="#">Careers</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                                <li><a href="#">Terms of Service</a></li>
                                <li><a href="#">Blog</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <div class="footer-links">
                            <h5>Contact</h5>
                            <ul>
                                <li><a href="mailto:info@techshieldpro.com">info@techshieldpro.com</a></li>
                                <li><a href="tel:+18005551234">+1 (800) 555-1234</a></li>
                                <li>123 Tech Street<br>San Francisco, CA 94107</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <hr class="my-5" style="border-color: rgba(255,255,255,0.1);">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="mb-0">Â© 2023 TechShield Pro. All rights reserved.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <div class="d-flex justify-content-md-end">
                            <img src="https://www.freepnglogos.com/uploads/visa-card-logo-9.png" alt="Visa" class="me-2"
                                height="30">
                            <img src="https://www.freepnglogos.com/uploads/mastercard-png/mastercard-logo-png-transparent-svg-vector-bie-supply-0.png"
                                alt="Mastercard" class="me-2" height="30">
                            <img src="https://www.freepnglogos.com/uploads/logo-paypal-png/logo-paypal-png-paypal-logo-png-vector-download-19.png"
                                alt="PayPal" class="me-2" height="30">
                            <img src="https://www.freepnglogos.com/uploads/apple-pay-png/apple-pay-icon-33.png"
                                alt="Apple Pay" height="30">
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Bootstrap JS Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            // Cart functionality
            let cart = [];
            const cartIcon = document.getElementById('cart-icon');
            const cartSidebar = document.getElementById('cart-sidebar');
            const closeCart = document.getElementById('close-cart');
            const overlay = document.getElementById('overlay');
            const cartItems = document.getElementById('cart-items');
            const cartSummary = document.getElementById('cart-summary');
            const cartTotal = document.getElementById('cart-total');
            const cartCount = document.querySelector('.cart-count');
            const toastContainer = document.getElementById('toast-container');

            // Open cart
            cartIcon.addEventListener('click', (e) => {
                e.preventDefault();
                cartSidebar.classList.add('open');
                overlay.classList.add('active');
            });

            // Close cart
            closeCart.addEventListener('click', () => {
                cartSidebar.classList.remove('open');
                overlay.classList.remove('active');
            });

            // Close cart when clicking overlay
            overlay.addEventListener('click', () => {
                cartSidebar.classList.remove('open');
                overlay.classList.remove('active');
            });

            // Add to cart functionality
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', (e) => {
                    const product = {
                        id: button.getAttribute('data-id'),
                        name: button.getAttribute('data-name'),
                        price: parseFloat(button.getAttribute('data-price')),
                        image: button.getAttribute('data-image'),
                        quantity: 1
                    };

                    addToCart(product);
                    showToast('Product added to cart', `${product.name} has been added to your cart.`);
                });
            });

            // Add product to cart
            function addToCart(product) {
                const existingItem = cart.find(item => item.id === product.id);

                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push(product);
                }

                updateCart();
            }

            // Remove item from cart
            function removeFromCart(productId) {
                cart = cart.filter(item => item.id !== productId);
                updateCart();
            }

            // Update quantity
            function updateQuantity(productId, newQuantity) {
                if (newQuantity < 1) {
                    removeFromCart(productId);
                    return;
                }

                const item = cart.find(item => item.id === productId);
                if (item) {
                    item.quantity = newQuantity;
                    updateCart();
                }
            }

            // Update cart UI
            function updateCart() {
                // Update cart count
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                cartCount.textContent = totalItems;

                // Update cart items
                if (cart.length === 0) {
                    cartItems.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <h5>Your cart is empty</h5>
                        <p class="text-muted">Add some products to your cart</p>
                    </div>
                `;
                    cartSummary.style.display = 'none';
                } else {
                    cartItems.innerHTML = '';
                    let total = 0;

                    cart.forEach(item => {
                        const itemTotal = item.price * item.quantity;
                        total += itemTotal;

                        const cartItem = document.createElement('div');
                        cartItem.className = 'cart-item';
                        cartItem.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="cart-item-img">
                        <div class="cart-item-details">
                            <h6 class="cart-item-title">${item.name}</h6>
                            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn minus" data-id="${item.id}">-</button>
                                <input type="text" class="quantity-input" value="${item.quantity}" data-id="${item.id}">
                                <button class="quantity-btn plus" data-id="${item.id}">+</button>
                                <button class="remove-item" data-id="${item.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;

                        cartItems.appendChild(cartItem);
                    });

                    cartTotal.textContent = `$${total.toFixed(2)}`;
                    cartSummary.style.display = 'block';

                    // Add event listeners to quantity buttons
                    document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.getAttribute('data-id');
                            const item = cart.find(item => item.id === id);
                            if (item) {
                                updateQuantity(id, item.quantity - 1);
                            }
                        });
                    });

                    document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.getAttribute('data-id');
                            const item = cart.find(item => item.id === id);
                            if (item) {
                                updateQuantity(id, item.quantity + 1);
                            }
                        });
                    });

                    document.querySelectorAll('.remove-item').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.closest('.remove-item').getAttribute('data-id');
                            removeFromCart(id);
                        });
                    });

                    document.querySelectorAll('.quantity-input').forEach(input => {
                        input.addEventListener('change', (e) => {
                            const id = e.target.getAttribute('data-id');
                            const newQuantity = parseInt(e.target.value);
                            if (!isNaN(newQuantity) && newQuantity > 0) {
                                updateQuantity(id, newQuantity);
                            } else {
                                updateCart(); // Reset to current quantity
                            }
                        });
                    });
                }
            }

            // Show toast notification
            function showToast(title, message) {
                const toast = document.createElement('div');
                toast.className = 'toast toast-success';
                toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-check"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="close-toast">
                    <i class="fas fa-times"></i>
                </button>
            `;

                toastContainer.appendChild(toast);

                // Show toast
                setTimeout(() => {
                    toast.classList.add('show');
                }, 100);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    hideToast(toast);
                }, 5000);

                // Close button
                toast.querySelector('.close-toast').addEventListener('click', () => {
                    hideToast(toast);
                });
            }

            // Hide toast
            function hideToast(toast) {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }

            // Initialize cart
            updateCart();
        </script>
        </body>

        </html>